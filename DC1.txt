
# Set details
$SERVERNAME = "dc1"
$FOREST = "ads.eoinlyng.ie"
$DNSNAME = $SERVERNAME + "." + $FOREST

# Set the IP address for the DC 
Rename-Computer -NewName $SERVERNAME
Get-NetIPAddress
New-NetIPAddress -InterfaceIndex 16 -IPAddress 192.168.0.11 -DefaultGateway "192.168.0.1" -PrefixLength 24 
Set-DnsClientServerAddress -InterfaceIndex 4 -ServerAddresses ("192.168.0.1","8.8.8.8")

Restart-Computer


#Install Active Directory for new Forest (prompted for Administrator Password during install)
Install-WindowsFeature -name AD-Domain-Services â€“IncludeManagementTools

Import-Module ADDSDeployment
Install-ADDSForest `
-CreateDnsDelegation:$false `
-DatabasePath "C:\Windows\NTDS" `
-DomainMode "WinThreshold" `
-DomainName "maynooth.ads.electric-petrol.ie" `
-DomainNetbiosName "eoinlyng" `
-ForestMode "WinThreshold" `
-InstallDns:$true `
-LogPath "C:\Windows\NTDS" `
-NoRebootOnCompletion:$false `
-SysvolPath "C:\Windows\SYSVOL" `
-Force:$true

Shutdown /r /t 0


# Install DHCP
Install-WindowsFeature DHCP -IncludeManagementTools

# Configure DHCP, add a single scope
$SERVERNAME = "dc1"
$FOREST = "ads.eoinlyng.ie"
$DNSNAME = $SERVERNAME + "." + $FOREST
Add-DhcpServerInDC -DnsName $DNSNAME -IPAddress 10.34.6.11
Add-DhcpServerv4Scope -Name VLAN1 ISP -StartRange 10.34.1.100 -EndRange 10.34.1.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Hosts that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN2 Hosts -StartRange 10.34.2.100 -EndRange 10.34.2.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Hosts that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN3 StaffRadio -StartRange 10.34.3.100 -EndRange 10.34.3.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Staff Wifi"
Add-DhcpServerv4Scope -Name VLAN4 Power -StartRange 10.34.4.100 -EndRange 10.34.4.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for power infrastructure that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN5 TechnicalClients -StartRange 10.34.5.100 -EndRange 10.34.5.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for technical clients"
Add-DhcpServerv4Scope -Name VLAN6 InfraServers -StartRange 10.34.6.100 -EndRange 10.34.6.199 -SubnetMask 255.255.255.0 -State Active -State Active-Description "DHCP addresses for servers that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN7 Telephony -StartRange 10.34.7.100 -EndRange 10.34.7.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for IP Phones"
Add-DhcpServerv4Scope -Name VLAN8 HVAC -StartRange 10.34.8.100 -EndRange 10.34.8.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for HVAC that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN9 Storage -StartRange 10.34.9.100 -EndRange 10.34.9.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Storage that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN10 NetMan -StartRange 10.34.10.100 -EndRange 10.34.10.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for net management that don't require a static address"
Add-DhcpServerv4Scope -Name VLAN11 SecurityCameras -StartRange 10.34.11.100 -EndRange 10.34.11.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Security Cameras"
Add-DhcpServerv4Scope -Name VLAN13 ClusterChat -StartRange 10.34.13.100 -EndRange 10.34.13.199 -SubnetMask 255.255.255.0  -State Active -Description "DHCP addresses for ClusterChat"
Add-DhcpServerv4Scope -Name VLAN14 LoopBacks -StartRange 10.34.14.100 -EndRange 10.34.14.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Loopbacks"
Add-DhcpServerv4Scope -Name VLAN15 Routers -StartRange 10.34.15.100 -EndRange 10.34.15.199 -SubnetMask 255.255.255.0  -State Active -Description "DHCP addresses for Routers"
Add-DhcpServerv4Scope -Name VLAN16 Links -StartRange 10.34.16.100 -EndRange 10.34.16.199 -SubnetMask 255.255.255.0 -State Active -Description "DHCP addresses for Links"


# Create DHCP exclusions
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.1.0 -StartRange 10.34.1.200 -EndRange 10.34.1.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.2.0 -StartRange 10.34.2.200 -EndRange 10.34.2.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.3.0 -StartRange 10.34.3.200 -EndRange 10.34.3.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.4.0 -StartRange 10.34.4.200 -EndRange 10.34.4.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.5.0 -StartRange 10.34.5.200 -EndRange 10.34.5.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.6.0 -StartRange 10.34.6.200 -EndRange 10.34.6.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.7.0 -StartRange 10.34.7.200 -EndRange 10.34.7.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.8.0 -StartRange 10.34.8.200 -EndRange 10.34.8.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.9.0 -StartRange 10.34.9.200 -EndRange 10.34.9.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.10.0 -StartRange 10.34.10.200 -EndRange 10.34.10.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.11.0 -StartRange 10.34.11.200 -EndRange 10.34.11.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.13.0 -StartRange 10.34.13.200 -EndRange 10.34.13.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.14.0 -StartRange 10.34.14.200 -EndRange 10.34.14.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.15.0 -StartRange 10.34.15.200 -EndRange 10.34.15.254
Add-DhcpServerv4ExclusionRange -ScopeID 10.34.16.0 -StartRange 10.34.16.200 -EndRange 10.34.16.254


#Create DNS records for Servers storage and Hosts in Forward lookup zone
Add-DnsServerResourceRecordA -Name "host1" -ZoneName "ads.eoinlyng.ie" -AllowUpdateAny -IPv4Address "192.168.0.10" -TimeToLive 01:00:00
A